{% extends 'app/base.html' %}

{% block content %}
<!-- post title and content -->
<h1>{{ post.title }}</h1>
<p>{{ post.url|urlize }}</p>
<p>
    {{ post.votes }} vote{{ post.votes|pluralize }}
    by {{ post.user.username }} on {{ post.date }}
    | {% if post.user == request.user %}
    <a href="{% url 'app:post_delete' post.id %}">delete</a>
    {% endif %}
</p>

<!-- comment form -->
{% if user.is_authenticated %}
<h3>Add a comment</h3>
<form method="post" action="{% url 'app:add_comment' post.id %}">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">Submit Comment</button>
</form>
{% else %}
<p><a href="{% url 'login' %}">Log in</a> to add a comment.</p>
{% endif %}

<!-- comment section -->
<h2>Comments</h2>
{% for comment in comments %}
    <div class="comment">
        {{ comment.content }}
        <p>
            {{ comment.votes }} vote{{ comment.votes|pluralize }}
            by {{ comment.user.username }} on {{ comment.created_at }}
            {% if comment.user == request.user %}
                | <a href="{% url 'app:comment_delete' comment.id %}">delete</a>
            {% endif %}
        </p>
    </div>

    <h3>Reply</h3>
    {% if user.is_authenticated %}
    <h3>Add a comment</h3>
    <form method="post" action="{% url 'app:reply' comment.id %}">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit">Submit Comment</button>
    </form>
    {% else %}
    <p><a href="{% url 'login' %}">Log in</a> to add a comment.</p>
    {% endif %}

    {% include "app/comment_replies.html" %}
{% empty %}
    <p>No comments yet.</p>
{% endfor %}
{% endblock %}
